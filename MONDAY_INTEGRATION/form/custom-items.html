<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Items - Good Boy Custom Order Form</title>
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/form.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="../index.html" class="logo">Good Boy Custom</a>
                <ul class="nav-menu">
                    <li><a href="../index.html#features" class="nav-link">Features</a></li>
                    <li><a href="../index.html#process" class="nav-link">Process</a></li>
                    <li><a href="../index.html#products" class="nav-link">Products</a></li>
                </ul>
                <button class="mobile-menu-toggle">☰</button>
            </nav>
        </div>
    </header>

    <main class="form-container">
        <div class="form-header">
            <h1 class="form-title">Custom & Specialty Items</h1>
            <p class="form-description">
                Need something unique? Describe any custom or specialty items you'd like us to create for your project.
            </p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 60%;"></div>
            </div>
            <div class="progress-steps">
                <div class="step completed"><div class="step-number">1</div><span>Welcome</span></div>
                <div class="step completed"><div class="step-number">2</div><span>Project</span></div>
                <div class="step completed"><div class="step-number">3</div><span>Products</span></div>
                <div class="step completed"><div class="step-number">4</div><span>Details</span></div>
                <div class="step completed"><div class="step-number">5</div><span>Custom</span></div>
            </div>
        </div>

        <form class="form-step" id="custom-items-form">
            <div class="form-section">
                <h2 class="form-section-title">Custom Items</h2>
                <p class="form-section-description">
                    Add any specialty items or custom requests beyond our standard product catalog.
                </p>

                <div id="custom-items-container">
                    <!-- Custom items will be added here dynamically -->
                </div>

                <div class="add-custom-item" id="add-custom-item-btn">
                    <span class="add-custom-item-icon">+</span>
                    Add Custom Item
                </div>
            </div>

            <div class="form-navigation">
                <button type="button" class="btn btn-ghost" id="prev-btn">
                    <span>←</span>
                    Previous
                </button>
                <div>
                    <span class="form-progress-text">Step 6 of 9</span>
                    <button type="submit" class="btn btn-primary" id="next-btn">
                        Continue
                        <span>→</span>
                    </button>
                </div>
            </div>
        </form>
    </main>

    <script src="../config/config.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('custom-items-form');
            const prevBtn = document.getElementById('prev-btn');
            const addBtn = document.getElementById('add-custom-item-btn');
            const container = document.getElementById('custom-items-container');
            let customItems = [];

            prevBtn.addEventListener('click', () => window.location.href = 'customization.html');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                saveFormData();
                window.location.href = 'logo-upload.html';
            });

            addBtn.addEventListener('click', addCustomItem);

            function addCustomItem() {
                const itemId = Date.now();
                const item = document.createElement('div');
                item.className = 'custom-item';
                item.dataset.itemId = itemId;
                
                item.innerHTML = `
                    <div class="custom-item-header">
                        <span class="custom-item-title">Custom Item ${customItems.length + 1}</span>
                        <button type="button" class="custom-item-remove">✕</button>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Item Description *</label>
                        <textarea class="form-textarea item-description" placeholder="Describe the custom item you need..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-item">
                            <input type="checkbox" class="checkbox creative-freedom">
                            <span>Give us creative freedom with the design</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Special Requirements</label>
                        <textarea class="form-textarea special-requirements" placeholder="Any specific requirements, dimensions, or constraints..."></textarea>
                    </div>
                `;
                
                container.appendChild(item);
                customItems.push({ id: itemId, element: item });
                
                item.querySelector('.custom-item-remove').addEventListener('click', () => removeCustomItem(itemId));
            }

            function removeCustomItem(itemId) {
                customItems = customItems.filter(item => item.id !== itemId);
                document.querySelector(`[data-item-id="${itemId}"]`).remove();
            }

            function saveFormData() {
                const items = Array.from(container.querySelectorAll('.custom-item')).map(item => ({
                    description: item.querySelector('.item-description').value,
                    creativeFreedom: item.querySelector('.creative-freedom').checked,
                    requirements: item.querySelector('.special-requirements').value
                }));

                let existingData = {};
                try {
                    existingData = JSON.parse(localStorage.getItem('goodboy-form-data')) || {};
                } catch (e) {}

                localStorage.setItem('goodboy-form-data', JSON.stringify({
                    ...existingData,
                    customItems: items
                }));
            }

            // Load saved data
            try {
                const savedData = JSON.parse(localStorage.getItem('goodboy-form-data'));
                if (savedData?.customItems?.length) {
                    savedData.customItems.forEach(() => addCustomItem());
                    setTimeout(() => {
                        const items = container.querySelectorAll('.custom-item');
                        savedData.customItems.forEach((data, index) => {
                            if (items[index]) {
                                items[index].querySelector('.item-description').value = data.description || '';
                                items[index].querySelector('.creative-freedom').checked = data.creativeFreedom || false;
                                items[index].querySelector('.special-requirements').value = data.requirements || '';
                            }
                        });
                    }, 100);
                }
            } catch (e) {}
        });
    </script>
</body>
</html>